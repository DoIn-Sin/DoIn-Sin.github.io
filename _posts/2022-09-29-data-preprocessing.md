---
title: 캐글로 배운느 데이터 전처리
description: kaggle의 Porto Seguro's Safe Driver를 공부하면서 배운 상황에 따른 전처리 기법을 정리했습니다.
categories:
- Data Preprocessing
- kaggle
tags: 
- Data Preprocessing
- Kaggle
- DS
---

# 주저리 주저리..
내가 이해한 데이터 전처리란 크게 보면 머신러닝/딥러닝의 성능 향상을 위해서 진행하는 것으로 이해했다. 그러기 위해서 스케일링을 통해 데이터를 정규화 시키고,

경우에 따라 표준화를 시켜 정규분포의 형태로 만드는 것 이외에도 결측치 제거/대체 등 학습 데이터를 학습하기 알맞은 형태로 만드는 과정을 거친다. 또한, 가끔 아는 도메인이라면

도메인 지식을 바탕으로 데이터를 다뤄왔다.

그런데..!! kaggle의 Porto Seguro's Safe Driver를 풀어보려고 했는데 feature가 모두 의미를 알 수 없게 비식별화 처리가 돼있었다!!

그래서 온전히 시각화와 분석을 통해 데이터를 처리해야하는 상황인 것이다... 더군다나 타겟값의 분포도 하나로 편향되어 있었기 때문에 문제가 더 어려워졌다ㅠㅜ

하나씩 접근해보자!!

# 데이터 전처리 실습
타겟값의 분포가 하나로 편향되어 있다고 했는데 얼마나 그런걸까? 시각화로 확인해봤다.

![image](https://user-images.githubusercontent.com/77676907/192960825-1641a571-bb34-45d0-ab4e-3725dcab6028.png)

이진분류의 문제에서 이렇게 하나로 편향되어 있으면 적은 비율의 타겟값인 1을 예측해내는 것이 매우 중요하다. 

그렇기 때문에 각 feature의 고윳값마다 타겟값 1의 분포가 어떤지 살펴보면서 각각의 고윳값이 가지는 타겟값의 분포가 다른지, 신뢰구간은 너무 넓지 않은지를 봐야한다!

무슨 말인지 예를 들어서 살펴보자.

>고윳값에 따른 타겟값 분포 비교하기
- 고윳값별로 타겟값 1의 분포가 어떤지 확인해서 고윳값마다 비슷한 경우, 어떤 고윳값이냐가 중요하지 않아지기 때문에 예측에 큰 도움을 주지 못한다.
- 따라서 고윳값별로 타겟값의 분포가 다른 것이 예측에 도움이 된다.

>고윳값에 따른 타겟값 분포의 신뢰구간 확인하기
- 신뢰구간이 너무 넓다면, 그 값에 대한 분포가 정확하지 않기 때문에 예측에 도움이 될지, 방해가 될지 판단하기 어려워진다. (통계적 유효성이 떨어지기 때문)
    - 예를들어, 도인이의 키가 실제 178cm인데 160~200cm 사이라고 하면 178cm를 잘 나타내지 못하게 된다! 이런 경우가 신뢰구간이 너무 넓다는 경우다.
- 따라서 신뢰구간이 너무 넓지 않은 분포를 찾는 것이 더 좋겠다.

그럼 이 데이터를 가지고 각각의 자료형마다 타겟값 1의 분포는 어떠한지 알아보자.

## 1. 이진 피처의 고윳값에 따른 타겟값 분포

![image](https://user-images.githubusercontent.com/77676907/192982984-08d663b7-512c-4f2a-8fed-3fee568f0d1f.png)

위의 그래프들을 보고 앞에서 설명했던 변수 선택 기준을 적용하여 제거할만한 피처를 찾을 수 있겠는가?

제거해야할 피처는 ps_ind_10_bin~ps_ind_13_bin과 ps_calc_15_bin~ps_calc_20_bin이다.

>ps_ind_10_bin~ps_ind_13_bin의 경우
- 신뢰구간이 너무 넓어서 통계적 유효성이 떨어짐

>ps_calc_15_bin~ps_calc_20_bin
- 고윳값별 타겟값 1의 비율 차이가 없어 타겟값 예측력이 없음

이것과 비슷하게 찾았다면 잘 이해했다고 보면 된다. 물론 위의 피처들이 절대적인 정답은 아니다. 사람마다 신뢰구간의 넓은 정도와 고윳값별 타겟값 비율의 적당함이 다르기 때문이다. 여기서는 이런 논리로 변수를 선택하고 제거하기도 하는구나 정도만 이해하면 된다!

## 2. 명목평 피처의 고윳값에 따른 타겟값 분포
![image](https://user-images.githubusercontent.com/77676907/192984299-654005c0-3e67-4201-8e11-722d1b002dff.png)

명목형 피처에는 -1 이라는 고윳값이 포함되어 있는데, 현재 데이터에서는 결측치를 나타내고 있다. 보통은 결측치의 개수에 따라 제거or보간을 하지만 여기서는 하나의 고윳값으로 인정하려 한다.

>결측치를 고윳값으로 인정하려는 이유
결측치가 있을 때의 타겟값 1의 비율이 높은 그래프들이 여럿 보이고, 없는 경우에는 -1이 없을 때 타겟값이 0이라고 유추할 수도 있다. 따라서 이렇게 결측치가 타겟값에 영향을 미치고 있는 경우에는 제거를 하지 않는 것이 더 나을 수도 있다!!

## 3. 순서형 피처의 고윳값에 따른 타겟값 분포
![image](https://user-images.githubusercontent.com/77676907/192985670-e8b944ff-b734-443e-b5c6-14046a3b11f4.png)

동일한 기준을 적용시켜보면,

>ps_ind_14
- 신뢰구간이 너무 넓어서 통계적 유효성이 떨어짐

>ps_calc_04~ps_calc_14
- 고윳값별 타겟값 1의 비율 차이가 없어 타겟값 예측력이 없음

다음은 연속형 피처이다.

## 4. 연속형 피처의 고윳값에 따른 타겟값 분포
연속형 피처의 경우 고윳값이 굉장히 많기 때문에 이를 구간별로 묶어서 범주화를 해주는 것이 시각화에 도움이 된다.

![image](https://user-images.githubusercontent.com/77676907/192986407-e0b8dfb5-8fcf-40e7-9aff-369636e112e6.png)

>ps_calca_01~ps_calc_03
- 고윳값dml 구간별 타겟값 1의 비율 차이가 없어 타겟값 예측력이 없음

이렇게 범주화를 시켜서 확인할 수도 있고 피어슨 상관계수를 통해 상관관계를 확인하는 방법도 있다. 상관관게가 높은 변수가 있다면, 둘 중 하나를 제거하는게 더 좋을 수 있다. (어차피 비슷한 지표를 나타내고 있기 때문에 둘 다 사용하게 된다면, 특정 예측 결과에 너무 많은 영향을 끼치게 되므로!, 그러나 항상 제거하는 것이 정답은 아니다.)

## 5. 연속형 피처의 고윳값별 상관관계
![image](https://user-images.githubusercontent.com/77676907/192993478-29932b9d-36cc-4d73-87d6-4a1ce1e7b304.png)

위의 히트맵에서는 ps_car_12와 ps_car_14, ps_reg_02와 ps_reg_03이 상관관계가 높은 편으로 보인다. 실제 수치는 그렇게 높지 않기 떄문에 이를 제거or유지한 상태로 성능을 비교해서 적절히 판단하면 되겠다.


# Reference
[1] 머신러닝/딥러닝 문제해결 전략 8장 안전 운전자 예측